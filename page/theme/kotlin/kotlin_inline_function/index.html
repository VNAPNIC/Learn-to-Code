



<!doctype html>
<html lang="vi" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Tổng hợp tài liệu học lập trình">
      
      
        <link rel="canonical" href="https://buihainam.com/kotlin/kotlin_inline_function/">
      
      
        <meta name="author" content="Bùi Hải Nam">
      
      
        <meta name="lang:clipboard.copy" content="Sao chép vào bộ nhớ">
      
        <meta name="lang:clipboard.copied" content="Sao chép xong">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="Không tìm thấy tài liệu liên quan">
      
        <meta name="lang:search.result.one" content="1 tài liệu liên quan">
      
        <meta name="lang:search.result.other" content="# tài liệu liên quan">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../img/logo.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.2">
    
    
      
        <title>Kotlin Inline function - Bùi Hải Nam</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.30686662.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#00bcd4">
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
      <link rel="manifest" href="../../manifest.webmanifest">
    
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-139140751-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="cyan" data-md-color-accent="cyan">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#gioi-thieu" tabindex="1" class="md-skip">
        Vào thẳng nội dung
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://buihainam.com/" title="Bùi Hải Nam" class="md-header-nav__button md-logo">
          
            <img src="../../img/logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Bùi Hải Nam
            </span>
            <span class="md-header-nav__topic">
              
                Kotlin Inline function
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Tìm kiếm" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Nhập để bắt đầu tìm kiếm
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/VNAPNIC/Learn-to-Code" title="Đến kho lưu trữ mã nguồn" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    VNAPNIC/Learn-to-Code
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://buihainam.com/" title="Bùi Hải Nam" class="md-nav__button md-logo">
      
        <img src="../../img/logo.png" width="48" height="48">
      
    </a>
    Bùi Hải Nam
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/VNAPNIC/Learn-to-Code" title="Đến kho lưu trữ mã nguồn" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    VNAPNIC/Learn-to-Code
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="About" class="md-nav__link">
      About
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Programming
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Programming
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../programming/lap-trinh-tuyen-tinh-la-gi-uu-nhuoc-diem/" title="Lập trình tuyến tính là gì" class="md-nav__link">
      Lập trình tuyến tính là gì
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../programming/lap-trinh-cau-truc-la-gi-uu-nhuoc-diem/" title="Lập trình cấu trúc là gì" class="md-nav__link">
      Lập trình cấu trúc là gì
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../programming/lap-trinh-huong-doi-tuong-la-gi-uu-nhuoc-diem/" title="Lập trình hướng đối tượng là gì" class="md-nav__link">
      Lập trình hướng đối tượng là gì
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../programming/oop-vs-pop/" title="So sánh POP với OOP" class="md-nav__link">
      So sánh POP với OOP
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Java
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Java
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../java/ngon-ngu-java-la-gi/" title="Ngôn ngữ Java là gì" class="md-nav__link">
      Ngôn ngữ Java là gì
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../java/cac-tinh-chat-huong-doi-tuong-cua-java/" title="OOP Trong Java" class="md-nav__link">
      OOP Trong Java
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      JUnit
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        JUnit
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../junit/junit-la-gi-vi-du-junit-voi-eclipse-maven/" title="JUnit là gì" class="md-nav__link">
      JUnit là gì
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../junit/assertions-la-gi-code-vi-du-junit-voi-assertions/" title="Assertions là gì" class="md-nav__link">
      Assertions là gì
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../junit/test-runner-va-test-suite-tao-bo-test-voi-junit/" title="Test runner và Test suite" class="md-nav__link">
      Test runner và Test suite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../junit/thu-tu-chay-cac-test-case-trong-junit-vi-du/" title="Thứ tự chạy các test case trong JUnit" class="md-nav__link">
      Thứ tự chạy các test case trong JUnit
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../junit/junit-expected-exceptions-code-vi-du-test-exception-voi-junit/" title="JUnit Expected Exceptions" class="md-nav__link">
      JUnit Expected Exceptions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../junit/vi-du-junit-voi-matchers-va-assertthat/" title="JUnit với Matchers và assertThat" class="md-nav__link">
      JUnit với Matchers và assertThat
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../junit/vi-du-junit-ignoring-tests-va-timeout-voi-test-case/" title="JUnit Ignoring và Timeout với test case" class="md-nav__link">
      JUnit Ignoring và Timeout với test case
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Kotlin
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Kotlin
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../kotlin_basic/" title="Kotlin Basic" class="md-nav__link">
      Kotlin Basic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kotlin_class_inheritance/" title="Kotlin Class và kế thừa" class="md-nav__link">
      Kotlin Class và kế thừa
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kotlin_property_field/" title="Kotlin Property và field" class="md-nav__link">
      Kotlin Property và field
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kotlin_function/" title="Kotlin Funtion" class="md-nav__link">
      Kotlin Funtion
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Kotlin Inline function
      </label>
    
    <a href="./" title="Kotlin Inline function" class="md-nav__link md-nav__link--active">
      Kotlin Inline function
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Mục lục</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#gioi-thieu" class="md-nav__link">
    Giới thiệu
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#noinline" class="md-nav__link">
    noinline
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#non-local-return" class="md-nav__link">
    Non-local return
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reified-type-parameter-xac-inh-cu-the-kieu-param" class="md-nav__link">
    Reified type parameter (Xác định cụ thể kiểu param)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inine-property" class="md-nav__link">
    Inine property
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kotlin_higher_order_function/" title="Kotlin Higher order funtion" class="md-nav__link">
      Kotlin Higher order funtion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kotlin_inteface/" title="Kotlin Inteface" class="md-nav__link">
      Kotlin Inteface
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kotlin_data_class/" title="Kotlin Data class" class="md-nav__link">
      Kotlin Data class
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kotlin_nested_class/" title="Kotlin Nested class" class="md-nav__link">
      Kotlin Nested class
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kotlin_visibility_modifiers/" title="Kotlin Visibility Modifiers" class="md-nav__link">
      Kotlin Visibility Modifiers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kotlin_lambda/" title="Kotlin Lambda" class="md-nav__link">
      Kotlin Lambda
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kotlin_collection/" title="Kotlin Collection" class="md-nav__link">
      Kotlin Collection
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kotlin_enum_classes/" title="Kotlin Enum Classes" class="md-nav__link">
      Kotlin Enum Classes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kotlin_overloading_operator/" title="Kotlin Overloading operator" class="md-nav__link">
      Kotlin Overloading operator
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kotlin_range/" title="Kotlin Range" class="md-nav__link">
      Kotlin Range
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kotlin_idioms/" title="Kotlin Idioms" class="md-nav__link">
      Kotlin Idioms
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kotlin_exception/" title="Kotlin Exception" class="md-nav__link">
      Kotlin Exception
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kotlin_delegation/" title="Kotlin Delegation" class="md-nav__link">
      Kotlin Delegation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kotlin_delegated_property/" title="Kotlin Delegated property" class="md-nav__link">
      Kotlin Delegated property
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../call_java_from_kotlin/" title="Gọi Java code từ Kotlin" class="md-nav__link">
      Gọi Java code từ Kotlin
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../call_kotlin_from_java/" title="Gọi Kotlin từ Java" class="md-nav__link">
      Gọi Kotlin từ Java
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Dart
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Dart
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../dart/dart_environment_settings/" title="Dart Cài đặt môi trường" class="md-nav__link">
      Dart Cài đặt môi trường
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../dart/dart_core/" title="Dart Basic" class="md-nav__link">
      Dart Basic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../dart/dart_async_intro/" title="Dart Async" class="md-nav__link">
      Dart Async
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Flutter
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Flutter
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/flutter_introduction/" title="9 lý do tại sao nên chọn Flutter" class="md-nav__link">
      9 lý do tại sao nên chọn Flutter
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/flutter_screenutil/" title="Flutter ScreenUtil" class="md-nav__link">
      Flutter ScreenUtil
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Mục lục</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#gioi-thieu" class="md-nav__link">
    Giới thiệu
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#noinline" class="md-nav__link">
    noinline
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#non-local-return" class="md-nav__link">
    Non-local return
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reified-type-parameter-xac-inh-cu-the-kieu-param" class="md-nav__link">
    Reified type parameter (Xác định cụ thể kiểu param)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inine-property" class="md-nav__link">
    Inine property
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Kotlin Inline function</h1>
                
                <h2 id="gioi-thieu">Giới thiệu<a class="headerlink" href="#gioi-thieu" title="Permanent link">&para;</a></h2>
<p>Chúng ta đã biết khái niệm <a href="/kotlin/kotlin_inline_function/">high-order function</a>, việc sử dụng loại function này bộc lộ một số hạn chế lúc runtime: mỗi function là một object và nó giữ <a href="/kotlin/kotlin_lambda/#closures">closure</a> của nó. Bởi vậy, việc cấp phát bộ nhớ (cho cả function object, class) và các lời gọi ảo cho ra một chi phí lúc runtime. Tức là khi gọi các function này, một object sẽ được tạo ra để lưu trữ function và thêm vài function cần thiết cho class nữa. Việc này làm cho số function của project sẽ tăng lên nhanh chóng.</p>
<p>Việc này có thể được loại bỏ bằng cách inline các biểu thức lambda. Tức là code của function sẽ được thêm ngay ở nơi gọi function, tránh khởi tạo một instance để lưu function. VD:</p>
<div class="codehilite"><pre><span></span>  <span class="n">lock</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="p">{</span> <span class="n">foo</span><span class="p">()</span> <span class="p">}</span>
</pre></div>

<p>Bây giờ, nếu function <code>lock</code> là một inline function, compiler sẽ sinh ra đoạn code sau ngay ở nơi gọi hàm <code>lock</code> thay vì tạo một function object:</p>
<div class="codehilite"><pre><span></span>  <span class="n">l</span><span class="p">.</span><span class="n">lock</span><span class="p">()</span>
  <span class="k">try</span> <span class="p">{</span>
      <span class="n">foo</span><span class="p">()</span>
  <span class="p">}</span>
  <span class="k">finally</span> <span class="p">{</span>
      <span class="n">l</span><span class="p">.</span><span class="n">unlock</span><span class="p">()</span>
  <span class="p">}</span>
</pre></div>

<p>Để thấy được điều này, ta có thể decompile <em>Kotlin</em> code sang <em>Java</em> code bằng cách chọn <code>Tools</code> -&gt; <code>Kotlin</code> -&gt; <code>Show Kotlin bytecode</code>, sau đó chọn <code>Decompile</code> để xem. File sẽ được decompile ra file <em>Java</em> tương đương.</p>
<p>Để khai báo một inline function, ta thêm từ khóa <code>inline</code> khi khai báo function</p>
<div class="codehilite"><pre><span></span>  <span class="k">inline fun</span> <span class="nf">close</span><span class="p">(</span><span class="n">work</span><span class="p">:</span><span class="n">String</span><span class="p">,</span> <span class="n">process</span><span class="p">:</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Unit</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">//tiền xử lý</span>
      <span class="n">process</span><span class="p">(</span><span class="n">work</span><span class="p">)</span>
      <span class="n">println</span><span class="p">(</span><span class="s">&quot;close&quot;</span><span class="p">)</span>
  <span class="p">}</span>
</pre></div>

<p>Từ khóa <code>inline</code> sẽ có ảnh hưởng đến cả các lambda bên trong được truyền cho function. Nghĩa là tất cả các function bây giờ sẽ được inline ở nơi gọi.</p>
<div class="codehilite"><pre><span></span>  <span class="c1">//gọi inline function</span>
  <span class="k">fun</span> <span class="nf">main</span><span class="p">(</span><span class="n">arg</span><span class="p">:</span> <span class="n">Array</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;)</span> <span class="p">{</span>
      <span class="n">close</span><span class="p">(</span><span class="s">&quot;clean&quot;</span><span class="p">){</span>
          <span class="n">println</span><span class="p">(</span><span class="s">&quot;cleaning&quot;</span><span class="p">)</span>
      <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">//code Java tương đương</span>
  <span class="k">public</span> <span class="k">final</span> <span class="n">void</span> <span class="n">main</span><span class="p">(</span><span class="n">@NotNull</span> <span class="n">String</span><span class="p">[]</span> <span class="n">arg</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Intrinsics</span><span class="p">.</span><span class="n">checkParameterIsNotNull</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="s">&quot;arg&quot;</span><span class="p">);</span>
      <span class="n">String</span> <span class="n">work</span><span class="err">$</span><span class="n">iv</span> <span class="p">=</span> <span class="s">&quot;clean&quot;</span><span class="p">;</span>
      <span class="n">String</span> <span class="n">var5</span> <span class="p">=</span> <span class="s">&quot;cleaning&quot;</span><span class="p">;</span>
      <span class="n">System</span><span class="p">.</span><span class="k">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">var5</span><span class="p">);</span>
      <span class="n">String</span> <span class="n">var4</span> <span class="p">=</span> <span class="s">&quot;close&quot;</span><span class="p">;</span>
      <span class="n">System</span><span class="p">.</span><span class="k">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">var4</span><span class="p">);</span>
  <span class="p">}</span>
</pre></div>

<p>Việc sử dụng inline function cũng có một số hạn chế. Đó là:</p>
<ul>
<li>Một inline function không thể tự gọi lại chính nó một cách trực tiếp hoặc gọi gián tiếp thông qua một inline funciton khác.</li>
<li>Một public inline function được khai báo ở trong một class chỉ có thể truy cập vào các public function và public field của class đó</li>
<li>Số lượng dòng code sẽ tăng lên. Việc inline một function dài, phức tạp nhiều lần sẽ được compiler sinh ra code tương ứng.</li>
</ul>
<p>Bởi vậy, lời khuyên ở đây là:</p>
<blockquote>
<p>Giữ các inline function ngắn gọn, chuyển các khối code lớn vào trong các non-inline function nếu cần.</p>
</blockquote>
<h2 id="noinline">noinline<a class="headerlink" href="#noinline" title="Permanent link">&para;</a></h2>
<p>Như ở trên đã đề cập, từ khóa <code>inline</code> có tác dụng với cả các lambda được truyền vào function. Bởi vậy, các lambda được truyền vào cũng sẽ là các inline function. Nếu không muốn điều này, chúng ta có thể sử dụng từ khóa <code>noinline</code> khi khai báo các lambda trong function</p>
<div class="codehilite"><pre><span></span>  <span class="k">inline fun</span> <span class="nf">close</span><span class="p">(</span><span class="n">work</span><span class="p">:</span><span class="n">String</span><span class="p">,</span><span class="k">noinline</span> <span class="n">process</span><span class="p">:</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Unit</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">//tiền xử lý</span>
      <span class="n">process</span><span class="p">(</span><span class="n">work</span><span class="p">)</span>
      <span class="n">println</span><span class="p">(</span><span class="s">&quot;close&quot;</span><span class="p">)</span>
  <span class="p">}</span>
</pre></div>

<p>Khi này, funciton <code>process</code> sẽ không được thêm vào code ở nơi gọi function mà sẽ khởi tạo một instance để chứa phần noinline đó.</p>
<div class="codehilite"><pre><span></span>  <span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="n">String</span><span class="o">[]</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">Intrinsics</span><span class="o">.</span><span class="na">checkParameterIsNotNull</span><span class="o">(</span><span class="n">arg</span><span class="o">,</span> <span class="s">&quot;arg&quot;</span><span class="o">);</span>
      <span class="n">String</span> <span class="n">work$iv</span> <span class="o">=</span> <span class="s">&quot;clean&quot;</span><span class="o">;</span>
      <span class="n">Function1</span> <span class="n">process$iv</span> <span class="o">=</span> <span class="o">(</span><span class="n">Function1</span><span class="o">)</span><span class="kc">null</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">;</span>
      <span class="n">process$iv</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">work$iv</span><span class="o">);</span>
      <span class="n">String</span> <span class="n">var5</span> <span class="o">=</span> <span class="s">&quot;close&quot;</span><span class="o">;</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">var5</span><span class="o">);</span>
   <span class="o">}</span>
</pre></div>

<p>Inline lambda chỉ có thể được gọi ở bên trong một inline function hoặc truyền vào param có kiểu inline. Với <code>noinline</code>, chúng ta có thể làm mọi thứ ta muốn: lưu như một biến, truyền vào param...</p>
<h2 id="non-local-return">Non-local return<a class="headerlink" href="#non-local-return" title="Permanent link">&para;</a></h2>
<p>Trong <em>Kotlin</em>, chúng ta có thể sử dụng <code>return</code> để thoát khỏi một function có tên hoặc một anonymous function. Điều đó có nghĩa là, để thoát khỏi một lambda, chúng ta phải sử dụng một <a href="/kotlin/kotlin_basic/#label-voi-return">label</a> để làm điều này và nếu chỉ sử dụng <code>return</code>, compiler sẽ báo lỗi bởi bên trong lambda, ta không thể thoát ra khởi function bên ngoài nó</p>
<div class="codehilite"><pre><span></span>  <span class="k">fun</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
      <span class="n">ordinaryFunction</span> <span class="p">{</span>
          <span class="k">return</span> <span class="c1">// ERROR: can not make `foo` return here</span>
      <span class="p">}</span>
  <span class="p">}</span>
</pre></div>

<p>Nhưng nếu function lambda được truyền vào là inline function, việc return là được cho phép:</p>
<div class="codehilite"><pre><span></span>  <span class="k">fun</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
      <span class="n">inlineFunction</span> <span class="p">{</span>
          <span class="k">return</span> <span class="c1">// OK: the lambda is inlined</span>
      <span class="p">}</span>
  <span class="p">}</span>
</pre></div>

<p>Những return này (bên trong lambda, nhưng thoát ra function xung quanh) được gọi là non-local return. Chúng ta thường sử dụng việc return này bên trong vòng lặp:</p>
<div class="codehilite"><pre><span></span>  <span class="k">fun</span> <span class="nf">hasZeros</span><span class="p">(</span><span class="n">ints</span><span class="p">:</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;):</span> <span class="n">Boolean</span> <span class="p">{</span>
      <span class="n">ints</span><span class="p">.</span><span class="n">forEach</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">it</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span> <span class="k">return</span> <span class="k">true</span> <span class="c1">// returns from hasZeros</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">false</span>
  <span class="p">}</span>
</pre></div>

<p>Lưu ý rằng inline function bên trong function có thể gọi lambda được truyền vào function chứa nó như một param một cách gián tiếp trong một ngữ cảnh thực thi như là một local object hay function lồng. Trong những trường hợp đó, luồng điều khiển non-local là được cho phép. Để thể hiện điều đó, lambda param cần được đánh dấu bằng từ khóa <code>crossinline</code>:</p>
<div class="codehilite"><pre><span></span>  <span class="k">inline fun</span> <span class="nf">f</span><span class="p">(</span><span class="k">crossinline</span> <span class="n">body</span><span class="p">:</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">Unit</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">val</span> <span class="py">f</span> <span class="p">=</span> <span class="k">object</span><span class="p">:</span> <span class="n">Runnable</span> <span class="p">{</span>
          <span class="k">override</span> <span class="k">fun</span> <span class="nf">run</span><span class="p">()</span> <span class="p">=</span> <span class="n">body</span><span class="p">()</span>
      <span class="p">}</span>
      <span class="c1">// ...</span>
  <span class="p">}</span>
</pre></div>

<p><code>break</code> và <code>continue</code> không được hỗ trợ trong inline lambda.</p>
<h2 id="reified-type-parameter-xac-inh-cu-the-kieu-param">Reified type parameter (Xác định cụ thể kiểu param)<a class="headerlink" href="#reified-type-parameter-xac-inh-cu-the-kieu-param" title="Permanent link">&para;</a></h2>
<p>Thỉnh thoảng chúng ta cần truy cập đến kiểu của tham số được truyền vào</p>
<div class="codehilite"><pre><span></span>  <span class="k">fun</span> <span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="nc">TreeNode</span><span class="p">.</span><span class="nf">findParentOfType</span><span class="p">(</span><span class="n">clazz</span><span class="p">:</span> <span class="n">Class</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;):</span> <span class="n">T</span><span class="p">?</span> <span class="p">{</span>
      <span class="k">var</span> <span class="py">p</span> <span class="p">=</span> <span class="n">parent</span>
      <span class="k">while</span> <span class="p">(</span><span class="n">p</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">clazz</span><span class="p">.</span><span class="n">isInstance</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="p">{</span>
          <span class="n">p</span> <span class="p">=</span> <span class="n">p</span><span class="p">.</span><span class="n">parent</span>
      <span class="p">}</span>
      <span class="n">@Suppress</span><span class="p">(</span><span class="s">&quot;UNCHECKED_CAST&quot;</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">p</span> <span class="k">as</span> <span class="n">T</span><span class="p">?</span>
  <span class="p">}</span>
</pre></div>

<p>Ở đây, function đi qua toàn bộ cây và sử dụng reflection để kiểm tra một node có kiểu xác định hay không. Nếu viết như vậy, việc gọi vẫn hơi dài dòng:</p>
<div class="codehilite"><pre><span></span>  <span class="n">treeNode</span><span class="p">.</span><span class="n">findParentOfType</span><span class="p">(</span><span class="n">MyTreeNode</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)</span>
</pre></div>

<p>Những gì chúng ta thực sự muốn là chỉ cần truyền kiểu param vào function:</p>
<div class="codehilite"><pre><span></span>  <span class="n">treeNode</span><span class="p">.</span><span class="n">findParentOfType</span><span class="p">&lt;</span><span class="n">MyTreeNode</span><span class="p">&gt;()</span>
</pre></div>

<p>Để làm điều này, inline function hỗ trợ việc này bằng cách sử dụng từ khóa <code>reified</code>:</p>
<div class="codehilite"><pre><span></span>  <span class="k">inline fun</span> <span class="p">&lt;</span><span class="k">reified</span> <span class="n">T</span><span class="p">&gt;</span> <span class="nc">TreeNode</span><span class="p">.</span><span class="nf">findParentOfType</span><span class="p">():</span> <span class="n">T</span><span class="p">?</span> <span class="p">{</span>
      <span class="k">var</span> <span class="py">p</span> <span class="p">=</span> <span class="n">parent</span>
      <span class="k">while</span> <span class="p">(</span><span class="n">p</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">p</span> <span class="p">!</span><span class="k">is</span> <span class="n">T</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">p</span> <span class="p">=</span> <span class="n">p</span><span class="p">.</span><span class="n">parent</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="n">p</span> <span class="k">as</span> <span class="n">T</span><span class="p">?</span>
  <span class="p">}</span>
</pre></div>

<p>Khi sử dụng <code>reified</code>, param đã có thể truy cập bên trong function và không cần sử dụng reflection nữa, các toán tử như <code>is</code>, <code>!is</code> hay <code>as</code> cũng đã hoạt động bình thường. Và từ đó, chúng ta có thể gọi function như đã đề cập ở trên:</p>
<div class="codehilite"><pre><span></span><span class="n">treeNode</span><span class="p">.</span><span class="n">findParentOfType</span><span class="p">&lt;</span><span class="n">MyTreeNode</span><span class="p">&gt;()</span>
</pre></div>

<p>Ngoài ra, ta vẫn có thể sử dụng reflection với reified type parameter:</p>
<div class="codehilite"><pre><span></span><span class="k">inline fun</span> <span class="p">&lt;</span><span class="k">reified</span> <span class="n">T</span><span class="p">&gt;</span> <span class="nf">membersOf</span><span class="p">()</span> <span class="p">=</span> <span class="n">T</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">members</span>

<span class="k">fun</span> <span class="nf">main</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="n">Array</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;)</span> <span class="p">{</span>
    <span class="n">println</span><span class="p">(</span><span class="n">membersOf</span><span class="p">&lt;</span><span class="n">StringBuilder</span><span class="p">&gt;().</span><span class="n">joinToString</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>

<p>Lưu ý: function không phải là inline function không thể sử dụng reified type parameter.</p>
<h2 id="inine-property">Inine property<a class="headerlink" href="#inine-property" title="Permanent link">&para;</a></h2>
<p>Từ khóa <code>inline</code> có thể được sử dụng với các hàm getter, setter của các property mà không có backing field. Bạn có thể đánh dấu từng hàm getter, setter:</p>
<div class="codehilite"><pre><span></span>  <span class="k">val</span> <span class="py">foo</span><span class="p">:</span> <span class="n">Foo</span>
      <span class="k">inline</span> <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">Foo</span><span class="p">()</span>

  <span class="k">var</span> <span class="py">bar</span><span class="p">:</span> <span class="n">Bar</span>
      <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="p">...</span>
      <span class="k">inline</span> <span class="k">set</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</pre></div>

<p>Bạn cũng có thể đánh dấu toàn bộ property bằng cách đánh dấu khi khai báo property:</p>
<div class="codehilite"><pre><span></span>  <span class="k">inline</span> <span class="k">var</span> <span class="py">bar</span><span class="p">:</span> <span class="n">Bar</span>
      <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="p">...</span>
      <span class="k">set</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</pre></div>

<p>Ở vị trí gọi function, các hàm getter, setter này cũng sẽ được coi như các hàm inline function bình thường.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../kotlin_function/" title="Kotlin Funtion" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Trước
                </span>
                Kotlin Funtion
              </span>
            </div>
          </a>
        
        
          <a href="../kotlin_higher_order_function/" title="Kotlin Higher order funtion" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Sau
                </span>
                Kotlin Higher order funtion
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 - 2020 Bùi Hải Nam
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="http://finishcoding.com/" class="md-footer-social__link fa fa-globe"></a>
    
      <a href="https://github.com/VNAPNIC" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://www.facebook.com/NankaiNotes" class="md-footer-social__link fa fa-facebook"></a>
    
      <a href="https://www.youtube.com/channel/UCECQ8GHamKx4H5jHMmNi2Ag" class="md-footer-social__link fa fa-youtube"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.c648116f.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>